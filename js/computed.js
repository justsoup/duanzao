!function(){let e=document.querySelector(".mainBox1"),t=document.querySelector(".mainBox2"),u={},l=null,n=function(){t.style.display="none",e.style.display="block";let l=document.getElementById("selectBox"),n=document.getElementById("select2Box"),o=(l.getElementsByTagName("options"),document.getElementById("grade")),r=document.getElementById("btn"),c=document.getElementById("result"),s=document.getElementById("imgBox"),m=document.getElementById("data1"),d=document.getElementById("data2"),i=document.getElementById("data3"),v=document.getElementById("data4"),b=document.getElementById("data5"),N=document.getElementById("data6"),h=document.getElementById("data7"),y=document.getElementById("data8"),g=document.getElementById("data9"),p=null,x=null,f=document.querySelector(".hiddenBox"),B={0:1100,1:1200,2:1200,3:1300,4:1700,5:1800,6:1800,7:1900,8:2200,9:2300,10:2300,11:2400};new Promise((e,t)=>{let u=null,l=new XMLHttpRequest;l.open("GET","json/attribute.txt"),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(u=l.responseText,e(u))},l.send(null)}).then(function(e){let t=e.toString();p=t.split(/[a-w]/i)}),r.onclick=function(){let e=o.value,t=l.selectedIndex,u=null,n=B[t],a=null,r=null,d=800;if(u=t<4?250:t<8?350:500,(d=d+100*parseFloat(b.value)+100*parseFloat(N.value)+60*parseFloat(h.value)+50*parseFloat(y.value))<parseFloat(n)){let e=parseFloat(n)-parseFloat(d);return c.innerText="失败了，需要再多加点燃料\n",void(c.innerText+="还缺少"+e+"°")}(a=function(e=0,t=0){return 250*e/t}(d,n))>u&&(a=u),r=Math.floor(e/50+3*a/20+.5*parseFloat(g.value)),x=1.2*r+parseFloat(m.value),x=Math.floor(100*x)/100,c.innerText="初始伤害为 "+x+"(只取整)\n",c.innerText+="锻造结果等级 "+r+"\n",0==l.value&&(console.log(l.value),c.innerText+="资料来源：放置江湖攻略组 \n"),s.style.display="block"};let E=function(){let e=l.value,t=n.value,u=p[t].replace(/^\s*|\s*$/g,"").split("\n")[e].split("\t");m.value=u[2],d.value=u[4],i.value=u[5],v.value=u[3]};l.onchange=E,n.onchange=E,s.onclick=function(){s.style.display="none",f.style.display="block"},f.onclick=function(){u.attack=x,u.hardness=d.value,u.toughness=i.value,u.weight=v.value,u.mold=n.value,a()}},a=function(){e.style.display="none",t.style.display="block";let n=document.getElementById("data00"),a=document.getElementById("data01"),o=document.getElementById("data02"),r=document.getElementById("data03"),c=document.getElementById("data04"),s=document.getElementById("data05"),m=document.getElementById("data06"),d=document.getElementById("show1"),i=document.getElementById("show2"),v=document.getElementById("btn2"),b=t.querySelectorAll("label"),N=document.getElementById("material1"),h=document.getElementById("material2"),y=document.getElementById("material3"),g=document.getElementById("btn3"),p=document.getElementById("btn4"),x=document.querySelector(".playBtn"),f=document.querySelector(".backBtn"),B=document.querySelector(".dataBtn"),E=document.querySelector(".resetBtn"),I=document.querySelector(".recastBox"),k=I.querySelectorAll("a"),w=document.getElementById("myMusic"),F=document.getElementById("input3"),T=document.getElementById("printBox");0!==Object.keys(u).length&&(n.value=parseInt(u.attack),a.value=u.weight,o.value=u.hardness,r.value=u.toughness);let S=null,q=null,C=null,V=!1,j={},M=null,O=1,A=1,G=0,H=1,J=!1,L=!1,P=null,R=o.value,X=r.value,$=[n.value,a.value,o.value,r.value,c.value],z=parseFloat(u.mold),D=["长剑","短剑","软剑","重剑","刺剑"],K=["长刀","大环刀","短刀","弯刀","双刃斧"],Q=["长棍","狼牙棒","三节棍","长枪","战戟"],U=["长鞭","软鞭","九节鞭","杆子鞭","链枷"],W=["双环","对剑","双钩"],Y=D.concat(K).concat(Q).concat(U).concat(W),Z=function(){let e=["1","0.033","0.4","-0.4","1","1","0.02","-0.4","0.4","1","1.1","0.01","0.15","-0.15","1.2","1.2","0.033","0.38","-0.38","1.1","1.2","0.02","-0.38","0.38","1.3","1.4","0.01","0.35","-0.25","1.45","1.2","0.03","0.05","-0.05","1.6","1.3","0.02","-0.25","0.25","1.7","1.4","0.01","0.03","-0.03","1.85","1.6","0.033","0.25","-0.2","1","1.4","0.02","-0.1","0.25","1.2","1.75","0.01","0.15","-0.05","1.2","1.25","0.01","0.2","-0.12","1.1","1.4","0.015","-0.15","0.25","1.15","1.5","0.01","0.12","-0.08","1.25"],t=["1.1","0.033","0.35","-0.2","1","1.2","0.02","-0.2","0.35","1.1","1.35","0.01","0.15","-0.15","1.25","1","0.025","0.33","-0.3","1","1.1","0.01","-0.25","0.28","1.1","1.2","0.01","0.2","-0.2","1.25","1.2","0.01","0.4","-0.4","1.1","1.3","0.02","-0.15","0.15","1","1.25","0.01","0.1","-0.1","1.2","1.1","0.03","0.2","-0.12","1","1.3","0.02","-0.12","0.2","1","1.15","0.015","0.15","-0.15","1.25","1.2","0.025","0.3","-0.32","1","1.25","0.038","-0.15","0.27","1.1","1.3","0.02","0.25","-0.22","1.25"],u=["1.1","0.03","0.3","-0.2","1","1.2","0.05","-0.2","0.25","1.1","1.25","0.05","0.2","-0.15","1.2","1","0.25","0.28","-0.15","1","1.1","0.05","-0.2","0.2","1.1","1.2","0.03","0.15","-0.15","1.2","1","0.02","0.12","-0.08","1","1.1","0.02","-0.4","0.4","1","1.25","0.01","0.1","-0.1","1.25","0.85","0.05","0.25","-0.2","1","0.9","0.04","-0.2","0.25","1.1","1","0.03","0.15","-0.15","1.35","0.95","0.05","0.22","-0.1","1","1","0.04","-0.2","0.18","1.1","1.15","0.03","0.15","-0.15","1.2"],l=["1","0.01","0.3","-0.3","1","1","0.01","-0.3","0.3","1.1","1.2","0.01","0.2","-0.2","1.25","0.8","0.005","0.15","-0.1","1.2","0.8","0.004","-0.1","0.25","1.25","1","0.002","0.1","-0.1","1.4","1","0.15","0.25","-0.2","1","0.9","0.1","-0.2","0.25","1.1","1.1","0.1","0.15","-0.15","1.25","0.75","0.03","0.15","-0.15","1.2","0.9","0.02","-0.15","0.15","1.3","1","0.01","0.1","-0.1","1.4","1.1","0.05","0.25","-0.1","1","0.98","0.08","-0.2","0.25","1.1","1.2","0.1","0.15","-0.05","1.2"],n=["1.15","0.04","0.2","-0.05","1.1","1.15","0.04","-0.12","0.2","1.1","0.9","0.03","0.14","0.1","0.85","1.2","0.05","0.2","-0.05","1.1","1.25","0.05","-0.12","0.2","1.1","1.1","0.04","0.14","0.1","1","1.6","0.04","0.23","-0.12","1","1.6","0.04","-0.12","0.23","1","1.4","0.03","0.18","0.18","1.1"],a=z,o=z,r=null,c=null;switch(r=0===(o=parseFloat(o)%5)?60:15*o-15,c=0===o?74:15*o-1,Math.floor(a/5.1)){case 0:S=["锐金","玄铁","晶竹"],q=e.slice(r,c+1);break;case 1:S=["陨铁","锡沙","秘银"],q=t.slice(r,c+1);break;case 2:S=["降龙木","锰钢","血龙木"],q=u.slice(r,c+1);break;case 3:S=["古藤","绵铁","蟒筋"],q=l.slice(r,c+1);break;case 4:S=["镜铁","磷石","黄晶"],q=n.slice(r,c+1)}};new Promise((e,t)=>{let u=null,l=new XMLHttpRequest;l.open("GET","json/recast.txt"),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(u=l.responseText,e(u))},l.send(null)}).then(function(e){let t=e.toString();M=t.split(" ");let l=parseInt(u.mold),n=6*(l-1),a=6*l-1;C=M.slice(n,a+1)}).then(Z).then(function(){if(0!==Object.keys(C).length){let e=C[4].split(","),t=C[5].split(",");N.textContent=S[0],h.textContent=S[1],y.textContent=S[2],j["c-name"]=C[0],j["c-attack"]=Number(C[1]),j["c-weight"]=Number(C[3]),j["c-down-hardness"]=Number(e[0]),j["c-up-hardness"]=Number(e[1]),j["c-down-toughness"]=Number(t[0]),j["c-up-toughness"]=Number(t[1]),T.innerText+="初始神兵"+j["c-name"]+"\n"}});let _=function(e,t,u){if(Number(e[1])<Number(t[1])&&Number(n.value)>=460)n.value=460;else if(Number(e[1])>Number(t[1])&&Number(n.value)>=460)n.value=460,T.innerText+="伤害不准确\n神兵已作废\n";else{let u=Number(n.value)+Number(c.value)*(Number(t[1])-Number(e[1]));n.value=u>460?460:u}a.value=Number(a.value)/Number(e[3])*Number(t[3]);let l=e[4].split(","),s=e[5].split(","),m=t[4].split(","),d=t[5].split(",");return o.value=(Number(m[1])-Number(m[0]))*(Number(o.value)-Number(l[0]))/(Number(l[1])-Number(l[0]))+Number(m[0]),Number(o.value)>Number(m[1])&&(o.value=Number(m[1])),r.value=(Number(d[1])-Number(d[0]))*(Number(r.value)-Number(s[0]))/(Number(s[1])-Number(s[0]))+Number(d[0]),Number(r.value)>Number(d[1])&&(r.value=Number(d[1])),[m,d,t[3]]},ee=function(e){b[1].childNodes[0].nodeValue="当前重量(上限"+e[2]+")",b[2].childNodes[0].nodeValue="当前硬度(上限"+e[0][1]+")",b[3].childNodes[0].nodeValue="当前韧度(上限"+e[1][1]+")",j["c-weight"]=e[2],j["c-down-hardness"]=e[0][0],j["c-up-hardness"]=e[0][1],j["c-down-toughness"]=e[1][0],j["c-up-toughness"]=e[1][1]};s.onchange=function(){d.innerText=this.value,o.value=Number(R)+Number(this.value)},m.onchange=function(){i.innerText=this.value,r.value=Number(X)+Number(this.value)},v.onclick=function(){Number(o.value)>Number(j["c-up-hardness"])&&(o.value=j["c-up-hardness"]),s.disabled=!0,m.disabled=!0,V=!0,b[1].childNodes[0].nodeValue="当前重量(上限"+j["c-weight"]+")",b[2].childNodes[0].nodeValue="当前硬度(上限"+j["c-up-hardness"]+")",b[3].childNodes[0].nodeValue="当前韧度(上限"+j["c-up-toughness"]+")",P=JSON.parse(JSON.stringify(j)),this.style.color="#eee",l=[n.value,a.value,o.value,r.value,c.value,u.mold]},N.onclick=function(){for(G=0,H=1;O;)V&&Number(c.value)<300&&($=[n.value,a.value,o.value,r.value,c.value,z],Number(n.value)<460&&(n.value=(Number(n.value)+Number(q[0])).toFixed(2)),Number(a.value)<j["c-weight"]&&(a.value=(Number(a.value)+Number(q[1])).toFixed(2)),!(Number(o.value)>=j["c-up-hardness"]&&Number(q[2])>0||Number(o.value)<j["c-down-hardness"]&&Number(q[2])<0)&&(o.value=(Number(o.value)+Number(q[2])).toFixed(2)),!(Number(r.value)>=j["c-up-toughness"]&&Number(q[3])>0||Number(r.value)<j["c-down-toughness"]&&Number(q[3])<0)&&(r.value=(Number(r.value)+Number(q[3])).toFixed(2)),c.value=Number(c.value)+1,G++),O--;O=Number(F.value),V&&Number(c.value)<=300&&G&&(T.innerText+="淬炼了"+G+this.textContent+"\n")},h.onclick=function(){for(G=0,H=1;O;)$=[n.value,a.value,o.value,r.value,c.value,z],V&&Number(c.value)<300&&(Number(n.value)<460&&(n.value=(Number(n.value)+Number(q[5])).toFixed(2)),Number(a.value)<j["c-weight"]&&(a.value=(Number(a.value)+Number(q[6])).toFixed(3)),!(Number(o.value)>=j["c-up-hardness"]&&Number(q[7])>0||Number(o.value)<j["c-down-hardness"]&&Number(q[7])<0)&&(o.value=(Number(o.value)+Number(q[7])).toFixed(2)),!(Number(r.value)>=j["c-up-toughness"]&&Number(q[8])>0||Number(r.value)<j["c-down-toughness"]&&Number(q[8])<0)&&(r.value=(Number(r.value)+Number(q[8])).toFixed(2)),c.value=Number(c.value)+1,G++),O--;O=Number(F.value),V&&Number(c.value)<=300&&G&&(T.innerText+="淬炼了"+G+this.textContent+"\n")},y.onclick=function(){for(G=0,H=1;O;)$=[n.value,a.value,o.value,r.value,c.value,z],V&&Number(c.value)<300&&(Number(n.value)<460&&(n.value=(Number(n.value)+Number(q[10])).toFixed(2)),Number(a.value)<j["c-weight"]&&(a.value=(Number(a.value)+Number(q[11])).toFixed(2)),!(Number(o.value)>=j["c-up-hardness"]&&Number(q[12])>0||Number(o.value)<j["c-down-hardness"]&&Number(q[12])<0)&&(o.value=(Number(o.value)+Number(q[12])).toFixed(2)),!(Number(r.value)>=j["c-up-toughness"]&&Number(q[13])>0||Number(r.value)<j["c-down-toughness"]&&Number(q[13])<0)&&(r.value=(Number(r.value)+Number(q[13])).toFixed(2)),c.value=Number(c.value)+1,G++),O--;O=Number(F.value),V&&Number(c.value)<=300&&G&&(T.innerText+="淬炼了"+G+this.textContent+"\n")},g.onclick=function(){if(A%2==0){if((O=Number(F.value))<1||O>300-Number(c.value))return O=1,void(F.value=1);this.style.background="#000",this.textContent="锁定解除",F.disabled=!0}else O=1,this.style.background="#c8e3c8",this.textContent="倍数锁定",F.disabled=!1,F.value=1;A++},x.onclick=function(){null!==w&&(w.paused?w.play():w.pause()),J?(this.className="playBtn",J=!J):(this.className+=" active",J=!J)},f.onclick=function(){H&&z===$[5]&&c.value!==$[4]&&(n.value=$[0],a.value=$[1],o.value=$[2],r.value=$[3],c.value=$[4],T.innerText+="回退了一次淬炼\n")},B.onclick=function(){T.innerText+="伤害 重量 硬度 韧度\n",T.innerText+=q.slice(0,4).join(" | ")+"\n",T.innerText+=q.slice(5,9).join(" | ")+"\n",T.innerText+=q.slice(10,14).join(" | ")+"\n"},E.onclick=function(){V&&(H=0,n.value=l[0],a.value=l[1],o.value=l[2],r.value=l[3],c.value=0,z=parseFloat(l[4]),Z(),T.innerText="初始神兵"+j["c-name"]+"\n",b[1].childNodes[0].nodeValue="当前重量(上限"+P["c-weight"]+")",b[2].childNodes[0].nodeValue="当前硬度(上限"+P["c-up-hardness"]+")",b[3].childNodes[0].nodeValue="当前韧度(上限"+P["c-up-toughness"]+")")},p.onclick=function(){if(V&&!L){L=!0,I.style.display="block";let e=[],t=u.mold;t<=5&&(e=D.slice()),t<=10&&z>5&&(e=K.slice()),t<=15&&z>10&&(e=Q.slice()),t<=20&&z>15&&(e=U.slice()),t>20&&(e=W.slice());let l=e.splice(z%5-1,1);for(let n=0;n<k.length;n++)k[n].textContent=e[n],k[n].onclick=function(){T.innerText+=l+"重铸成"+this.textContent+"\n",z=Y.indexOf(this.textContent)+1,u.mold=z;let e=M.slice(6*(t-1),6*t),n=M.slice(6*(z-1),6*z),a=(Z(),_(e,n));ee(a)}}else V&&L&&(L=!1,I.style.display="none")},I.onclick=function(){L=!1,I.style.display="none"}},o=window.location.href,r=o.indexOf("#");switch(-1===r?null:o.slice(r+1)){case"first":n();break;case"second":a();break;default:n()}}();