!function(){let e=document.querySelector(".mainBox1"),t=document.querySelector(".mainBox2"),u={},n=[],l=function(){t.style.display="none",e.style.display="block";let l=document.getElementById("selectBox"),o=document.getElementById("select2Box"),c=(l.getElementsByTagName("options"),document.getElementById("grade")),s=document.getElementById("btn"),r=document.getElementById("result"),m=document.getElementById("imgBox"),d=document.getElementById("data1"),i=document.getElementById("data2"),v=document.getElementById("data3"),b=document.getElementById("data4"),N=document.getElementById("data5"),h=document.getElementById("data6"),g=document.getElementById("data7"),y=document.getElementById("data8"),p=document.getElementById("data9"),x=null,f=null,B=document.querySelector(".hiddenBox"),w={0:1100,1:1200,2:1200,3:1300,4:1700,5:1800,6:1800,7:1900,8:2200,9:2300,10:2300,11:2400};new Promise((e,t)=>{let u=null,n=new XMLHttpRequest;n.open("GET","json/attribute.txt"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(u=n.responseText,e(u))},n.send(null)}).then(function(e){let t=e.toString();x=t.split(/[a-w]/i)}),s.onclick=function(){let e=c.value,t=l.selectedIndex,u=null,a=w[t],o=null,s=null,i=800;if(u=t<4?250:t<8?350:500,(i=i+100*parseFloat(N.value)+100*parseFloat(h.value)+60*parseFloat(g.value)+50*parseFloat(y.value))<parseFloat(a)){let e=parseFloat(a)-parseFloat(i);return r.innerText="失败了，需要再多加点燃料\n",void(r.innerText+="还缺少"+e+"°")}(o=function(e=0,t=0){return 250*e/t}(i,a))>u&&(o=u),s=Math.floor(e/50+3*o/20+.5*parseFloat(p.value)),f=1.2*s+parseFloat(d.value),f=Math.floor(100*f)/100,r.innerText="初始伤害为 "+f+"(只取整)\n",r.innerText+="锻造结果等级 "+s+"\n",0==l.value&&(console.log(l.value),r.innerText+="资料来源：放置江湖攻略组 \n"),m.style.display="block",n=[e,u,d.value]};let E=function(){let e=l.value,t=o.value,u=x[t].replace(/^\s*|\s*$/g,"").split("\n")[e].split("\t");d.value=u[2],i.value=u[4],v.value=u[5],b.value=u[3]};l.onchange=E,o.onchange=E,m.onclick=function(){m.style.display="none",B.style.display="block"},B.onclick=function(){u.attack=f,u.hardness=i.value,u.toughness=v.value,u.weight=b.value,u.mold=o.value,a()}},a=function(){e.style.display="none",t.style.display="block";let l=document.getElementById("data00"),a=document.getElementById("data01"),o=document.getElementById("data02"),c=document.getElementById("data03"),s=document.getElementById("data04"),r=document.getElementById("data05"),m=document.getElementById("data06"),d=document.getElementById("show1"),i=document.getElementById("show2"),v=document.getElementById("btn2"),b=t.querySelectorAll("label"),N=document.getElementById("material1"),h=document.getElementById("material2"),g=document.getElementById("material3"),y=document.getElementById("btn3"),p=document.getElementById("btn4"),x=document.querySelector(".playBtn"),f=document.querySelector(".backBtn"),B=document.querySelector(".dataBtn"),w=document.querySelector(".resetBtn"),E=document.querySelector(".recastBox"),I=E.querySelectorAll("a"),k=document.getElementById("myMusic"),F=document.getElementById("input3"),T=document.getElementById("printBox");0!==Object.keys(u).length&&(l.value=parseInt(u.attack),a.value=u.weight,o.value=u.hardness,c.value=u.toughness);let S=null,q=null,C=null,j=null,M=!1,O={},V={},A=null,G=1,H=1,L=0,P=null,R=!1,X=!1,$=!1,z=o.value,D=c.value,J=[l.value,a.value,o.value,c.value,s.value],K=parseFloat(u.mold),Q=["长剑","短剑","软剑","重剑","刺剑"],U=["长刀","大环刀","短刀","弯刀","双刃斧"],W=["长棍","狼牙棒","三节棍","长枪","战戟"],Y=["长鞭","软鞭","九节鞭","杆子鞭","链枷"],Z=["双环","对剑","双钩"],_=Q.concat(U).concat(W).concat(Y).concat(Z),ee=function(){let e=["1","0.033","0.4","-0.4","1","1","0.02","-0.4","0.4","1","1.1","0.01","0.15","-0.15","1.2","1.2","0.033","0.38","-0.38","1.1","1.2","0.02","-0.38","0.38","1.3","1.4","0.01","0.35","-0.25","1.45","1.2","0.03","0.05","-0.05","1.6","1.3","0.02","-0.25","0.25","1.7","1.4","0.01","0.03","-0.03","1.85","1.6","0.033","0.25","-0.2","1","1.4","0.02","-0.1","0.25","1.2","1.75","0.01","0.15","-0.05","1.2","1.25","0.01","0.2","-0.12","1.1","1.4","0.015","-0.15","0.25","1.15","1.5","0.01","0.12","-0.08","1.25"],t=["1.1","0.033","0.35","-0.2","1","1.2","0.02","-0.2","0.35","1.1","1.35","0.01","0.15","-0.15","1.25","1","0.025","0.33","-0.3","1","1.1","0.01","-0.25","0.28","1.1","1.2","0.01","0.2","-0.2","1.25","1.2","0.01","0.4","-0.4","1.1","1.3","0.02","-0.15","0.15","1","1.25","0.01","0.1","-0.1","1.2","1.1","0.03","0.2","-0.12","1","1.3","0.02","-0.12","0.2","1","1.15","0.015","0.15","-0.15","1.25","1.2","0.025","0.3","-0.32","1","1.25","0.038","-0.15","0.27","1.1","1.3","0.02","0.25","-0.22","1.25"],u=["1.1","0.03","0.3","-0.2","1","1.2","0.05","-0.2","0.25","1.1","1.25","0.05","0.2","-0.15","1.2","1","0.25","0.28","-0.15","1","1.1","0.05","-0.2","0.2","1.1","1.2","0.03","0.15","-0.15","1.2","1","0.02","0.12","-0.08","1","1.1","0.02","-0.4","0.4","1","1.25","0.01","0.1","-0.1","1.25","0.85","0.05","0.25","-0.2","1","0.9","0.04","-0.2","0.25","1.1","1","0.03","0.15","-0.15","1.35","0.95","0.05","0.22","-0.1","1","1","0.04","-0.2","0.18","1.1","1.15","0.03","0.15","-0.15","1.2"],n=["1","0.01","0.3","-0.3","1","1","0.01","-0.3","0.3","1.1","1.2","0.01","0.2","-0.2","1.25","0.8","0.005","0.15","-0.1","1.2","0.8","0.004","-0.1","0.25","1.25","1","0.002","0.1","-0.1","1.4","1","0.15","0.25","-0.2","1","0.9","0.1","-0.2","0.25","1.1","1.1","0.1","0.15","-0.15","1.25","0.75","0.03","0.15","-0.15","1.2","0.9","0.02","-0.15","0.15","1.3","1","0.01","0.1","-0.1","1.4","1.1","0.05","0.25","-0.1","1","0.98","0.08","-0.2","0.25","1.1","1.2","0.1","0.15","-0.05","1.2"],l=["1.15","0.04","0.2","-0.05","1.1","1.15","0.04","-0.12","0.2","1.1","0.9","0.03","0.14","0.1","0.85","1.2","0.05","0.2","-0.05","1.1","1.25","0.05","-0.12","0.2","1.1","1.1","0.04","0.14","0.1","1","1.6","0.04","0.23","-0.12","1","1.6","0.04","-0.12","0.23","1","1.4","0.03","0.18","0.18","1.1"],a=["460","25","150","30","300","460","25","30","150","300","460","25","120","30","300","460","15","140","25","300","460","15","25","120","300","460","15","120","25","300","460","15","30","10","300","460","15","10","90","300","460","15","30","10","300","460","50","60","40","300","460","50","40","200","300","460","50","60","40","300","460","13","65","40","300","460","14","18","120","300","460","15","50","50","300"],o=["460","35","160","35","300","460","35","35","140","300","460","35","160","35","300","460","45","170","45","300","460","25","30","180","300","460","25","170","45","300","460","15","150","40","300","460","15","40","110","300","460","15","150","30","300","460","20","120","20","300","460","20","20","120","300","460","20","120","20","300","460","45","155","35","300","460","50","40","160","300","460","55","135","45","300"],c=["460","50","100","30","300","460","50","30","100","300","460","50","100","30","300","460","60","200","20","300","460","60","60","90","300","460","60","200","20","300","460","25","90","20","300","460","25","20","90","300","460","25","90","20","300","460","45","130","30","300","460","45","45","100","300","460","45","130","30","300","460","40","135","45","300","460","45","40","90","300","460","50","115","35","300"],s=["460","20","160","20","300","460","20","20","160","300","460","20","160","20","300","460","12","40","40","300","460","10","10","120","300","460","12","40","40","300","460","40","160","25","300","460","40","50","80","300","460","40","160","25","300","460","25","100","20","300","460","25","20","100","300","460","25","120","30","300","460","20","140","30","300","460","38","30","90","300","460","45","125","40","300"],r=["460","35","130","40","300","460","35","30","120","300","460","25","110","70","300","460","40","100","30","300","460","40","30","170","300","460","30","80","120","300","460","35","130","40","300","460","35","30","130","300","460","25","90","90","300"],m=K,d=K,i=null,v=null;switch(i=0===(d=parseFloat(d)%5)?60:15*d-15,v=0===d?74:15*d-1,Math.floor(m/5.1)){case 0:S=["锐金","玄铁","晶竹"],q=e.slice(i,v+1),C=a.slice(i,v+1);break;case 1:S=["陨铁","锡沙","秘银"],q=t.slice(i,v+1),C=o.slice(i,v+1);break;case 2:S=["降龙木","锰钢","血龙木"],q=u.slice(i,v+1),C=c.slice(i,v+1);break;case 3:S=["古藤","绵铁","蟒筋"],q=n.slice(i,v+1),C=s.slice(i,v+1);break;case 4:S=["镜铁","磷石","黄晶"],q=l.slice(i,v+1),C=r.slice(i,v+1)}},te=function(){if(0!==Object.keys(j).length){let e=j[4].split(","),t=j[5].split(",");N.textContent=S[0],h.textContent=S[1],g.textContent=S[2],O["c-name"]=j[0],O["c-attack"]=Number(j[1]),O["c-weight"]=Number(j[3]),O["c-down-hardness"]=Number(e[0]),O["c-up-hardness"]=Number(e[1]),O["c-down-toughness"]=Number(t[0]),O["c-up-toughness"]=Number(t[1]),T.innerText="初始神兵"+O["c-name"]+"\n"}};new Promise((e,t)=>{let u=null,n=new XMLHttpRequest;n.open("GET","json/recast.txt"),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(u=n.responseText,e(u))},n.send(null)}).then(function(e){let t=e.toString();A=t.split(" ");let n=parseInt(u.mold),l=6*(n-1),a=6*n-1;j=A.slice(l,a+1)}).then(ee).then(te);let ue=function(e,t,u){if(Number(e[1])<Number(t[1])&&Number(l.value)>=460)l.value=460;else if(Number(e[1])>Number(t[1])&&Number(l.value)>=460){let e=Number(t[1]),u=Number(n[0])/50+5+3*(.5*Number(n[1])+Number(s.value)/2)/20,a=1.2*Math.min(u,100)+Number(n[2]);a+=Number(s.value)*e,l.value=a>460?460:a}else{let u=Number(l.value)+Number(s.value)*(Number(t[1])-Number(e[1]));l.value=u>460?460:u}a.value=Number(a.value)/Number(e[3])*Number(t[3]);let r=e[4].split(","),m=e[5].split(","),d=t[4].split(","),i=t[5].split(",");return o.value=(Number(d[1])-Number(d[0]))*(Number(o.value)-Number(r[0]))/(Number(r[1])-Number(r[0]))+Number(d[0]),Number(o.value)>Number(d[1])&&(o.value=Number(d[1])),c.value=(Number(i[1])-Number(i[0]))*(Number(c.value)-Number(m[0]))/(Number(m[1])-Number(m[0]))+Number(i[0]),Number(c.value)>Number(i[1])&&(c.value=Number(i[1])),[d,i,t[3]]},ne=function(e){O["c-weight"]=e[2],O["c-down-hardness"]=e[0][0],O["c-up-hardness"]=e[0][1],O["c-down-toughness"]=e[1][0],O["c-up-toughness"]=e[1][1],le()};r.onchange=function(){d.innerText=this.value,o.value=Number(z)+Number(this.value)},m.onchange=function(){i.innerText=this.value,c.value=Number(D)+Number(this.value)},v.onclick=function(){r.disabled=!0,m.disabled=!0,le(),this.style.color="#eee",M||(P=[l.value,a.value,o.value,c.value,s.value,u.mold]),M=!0},N.onclick=function(){for(L=0;G;)M&&Number(s.value)<300&&(V["c-weight"]=C[1],V["c-up-hardness"]=C[2],V["c-down-toughness"]=C[3],V["c-down-hardness"]=O["c-down-hardness"],V["c-up-toughness"]=O["c-up-toughness"],J=[l.value,a.value,o.value,c.value,s.value,K],Number(l.value)<460&&(l.value=(Number(l.value)+Number(q[0])).toFixed(2)),Number(a.value)<V["c-weight"]&&(a.value=(Number(a.value)+Number(q[1])).toFixed(2)),!(Number(o.value)>=V["c-up-hardness"]&&Number(q[2])>0||Number(o.value)<V["c-down-hardness"]&&Number(q[2])<0)&&(o.value=(Number(o.value)+Number(q[2])).toFixed(2)),!(Number(c.value)>=V["c-up-toughness"]&&Number(q[3])>0||Number(c.value)<V["c-down-toughness"]&&Number(q[3])<0)&&(c.value=(Number(c.value)+Number(q[3])).toFixed(2)),s.value=Number(s.value)+1,L++),G--;G=Number(F.value),M&&Number(s.value)<=300&&L&&(T.innerText+="淬炼了"+L+this.textContent+"\n")},h.onclick=function(){for(L=0;G;)J=[l.value,a.value,o.value,c.value,s.value,K],M&&Number(s.value)<300&&(V["c-weight"]=C[6],V["c-down-hardness"]=C[7],V["c-up-toughness"]=C[8],V["c-up-hardness"]=O["c-up-hardness"],V["c-down-toughness"]=O["c-down-toughness"],Number(l.value)<460&&(l.value=(Number(l.value)+Number(q[5])).toFixed(2)),Number(a.value)<V["c-weight"]&&(a.value=(Number(a.value)+Number(q[6])).toFixed(3)),!(Number(o.value)>=V["c-up-hardness"]&&Number(q[7])>0||Number(o.value)<V["c-down-hardness"]&&Number(q[7])<0)&&(o.value=(Number(o.value)+Number(q[7])).toFixed(2)),!(Number(c.value)>=V["c-up-toughness"]&&Number(q[8])>0||Number(c.value)<V["c-down-toughness"]&&Number(q[8])<0)&&(c.value=(Number(c.value)+Number(q[8])).toFixed(2)),s.value=Number(s.value)+1,L++),G--;G=Number(F.value),M&&Number(s.value)<=300&&L&&(T.innerText+="淬炼了"+L+this.textContent+"\n")},g.onclick=function(){for(L=0;G;)J=[l.value,a.value,o.value,c.value,s.value,K],M&&Number(s.value)<300&&(V["c-weight"]=C[11],V["c-up-hardness"]=C[12],V["c-down-toughness"]=C[13],V["c-down-hardness"]=O["c-down-hardness"],V["c-up-toughness"]=O["c-up-toughness"],Number(K)>20&&(V["c-down-toughness"]=O["c-down-toughness"],V["c-up-toughness"]=C[13]),Number(l.value)<460&&(l.value=(Number(l.value)+Number(q[10])).toFixed(2)),Number(a.value)<V["c-weight"]&&(a.value=(Number(a.value)+Number(q[11])).toFixed(2)),!(Number(o.value)>=V["c-up-hardness"]&&Number(q[12])>0||Number(o.value)<V["c-down-hardness"]&&Number(q[12])<0)&&(o.value=(Number(o.value)+Number(q[12])).toFixed(2)),!(Number(c.value)>=V["c-up-toughness"]&&Number(q[13])>0||Number(c.value)<V["c-down-toughness"]&&Number(q[13])<0)&&(c.value=(Number(c.value)+Number(q[13])).toFixed(2)),s.value=Number(s.value)+1,L++),G--;G=Number(F.value),M&&Number(s.value)<=300&&L&&(T.innerText+="淬炼了"+L+this.textContent+"\n")},y.onclick=function(){if(H%2==0){if((G=Number(F.value))<1||G>300-Number(s.value))return G=1,void(F.value=1);this.style.background="#000",this.textContent="锁定解除",F.disabled=!0}else G=1,this.style.background="#c8e3c8",this.textContent="倍数锁定",F.disabled=!1,F.value=1;H++},x.onclick=function(){null!==k&&(k.paused?k.play():k.pause()),X?(this.className="playBtn",X=!X):(this.className+=" active",X=!X)},f.onclick=function(){K===J[5]&&s.value!==J[4]&&(l.value=J[0],a.value=J[1],o.value=J[2],c.value=J[3],s.value=J[4],T.innerText+="回退了一次淬炼\n")},B.onclick=function(){T.innerText+="伤害 重量 硬度 韧度\n",T.innerText+=q.slice(0,4).join(" | ")+"\n",T.innerText+=q.slice(5,9).join(" | ")+"\n",T.innerText+=q.slice(10,14).join(" | ")+"\n"},w.onclick=function(){M&&(l.value=P[0],a.value=P[1],o.value=P[2],c.value=P[3],s.value=0,u.mold=K=parseFloat(P[5]),J[5]=null,ee(),T.innerText="初始神兵"+j[0]+"\n",R=!0,le())},p.onclick=function(){if(M&&!$){$=!0,E.style.display="block";let e=[],t=u.mold;t<=5&&(e=Q.slice()),t<=10&&K>5&&(e=U.slice()),t<=15&&K>10&&(e=W.slice()),t<=20&&K>15&&(e=Y.slice()),t>20&&(e=Z.slice());let n=e.splice(K%5-1,1);for(let l=0;l<I.length;l++)I[l].textContent=e[l],""!==I[l].textContent&&(I[l].onclick=function(){T.innerText+=n+"重铸成"+this.textContent+"\n",K=_.indexOf(this.textContent)+1,u.mold=K;let e=A.slice(6*(t-1),6*t),l=A.slice(6*(K-1),6*K),a=(ee(),ue(e,l));ne(a)})}else M&&$&&($=!1,E.style.display="none")},E.onclick=function(){$=!1,E.style.display="none"};let le=function(){R&&(te(),R=!1),b[1].childNodes[0].nodeValue="当前重量(上限"+O["c-weight"]+")",b[2].childNodes[0].nodeValue="当前硬度(上限"+O["c-up-hardness"]+")",b[3].childNodes[0].nodeValue="当前韧度(上限"+O["c-up-toughness"]+")"}},o=window.location.href,c=o.indexOf("#");switch(-1===c?null:o.slice(c+1)){case"first":l();break;case"second":a();break;default:l()}}();
