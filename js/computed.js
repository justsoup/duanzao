!function(){let e=document.querySelector(".mainBox1"),t=document.querySelector(".mainBox2"),u={},l={},n=function(){t.style.display="none",e.style.display="block";let n=document.getElementById("selectBox"),o=document.getElementById("select2Box"),r=(n.getElementsByTagName("options"),document.getElementById("grade")),c=document.getElementById("btn"),m=document.getElementById("result"),s=document.getElementById("imgBox"),d=document.getElementById("data1"),i=document.getElementById("data2"),b=document.getElementById("data3"),v=document.getElementById("data4"),N=document.getElementById("data5"),y=document.getElementById("data6"),h=document.getElementById("data7"),g=document.getElementById("data8"),p=document.getElementById("data9"),x=null,f=null,B=document.querySelector(".passwordBox"),I=document.getElementById("passInput"),E=document.querySelectorAll("a"),k=document.querySelector(".hiddenBox"),w={0:1100,1:1200,2:1200,3:1300,4:1700,5:1800,6:1800,7:1900,8:2200,9:2300,10:2300,11:2400};new Promise((e,t)=>{let u=null,l=new XMLHttpRequest;l.open("GET","json/attribute.txt"),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(u=l.responseText,e(u))},l.send(null)}).then(function(e){let t=e.toString();x=t.split(/[a-w]/i)}),c.onclick=function(){let e=r.value,t=n.selectedIndex,u=null,a=w[t],o=null,c=null,i=800;if(l.grade=e,u=t<4?250:t<8?350:500,l.meltingMax=u,(i=i+100*parseFloat(N.value)+100*parseFloat(y.value)+60*parseFloat(h.value)+50*parseFloat(g.value))<parseFloat(a)){let e=parseFloat(a)-parseFloat(i);return m.innerText="失败了，需要再多加点燃料\n",void(m.innerText+="还缺少"+e+"°")}(o=function(e=0,t=0){return 250*e/t}(i,a))>u&&(o=u),c=Math.floor(e/50+3*o/20+.5*parseFloat(p.value)),f=1.2*c+parseFloat(d.value),f=Math.floor(100*f)/100,m.innerText="初始伤害为 "+f+"(只取整)\n",m.innerText+="锻造结果等级 "+c+"\n",0==n.value&&(console.log(n.value),m.innerText+="资料来源：放置江湖攻略组 \n"),s.style.display="block"};let F=function(){let e=n.value,t=o.value,u=x[t].replace(/^\s*|\s*$/g,"").split("\n")[e].split("\t");d.value=u[2],i.value=u[4],b.value=u[5],v.value=u[3]};n.onchange=F,o.onchange=F,s.onclick=function(){s.style.display="none",k.style.display="block"},k.onclick=function(){B.style.display="block",E[0].onclick=function(){let e=btoa(I.value);"YWJhbmRvbg=="!==e&&"ZGVzZXJ0"!==e&&"Zm9yc2FrZQ=="!==e||(u.attack=f,u.hardness=i.value,u.toughness=b.value,u.weight=v.value,u.mold=o.value,l.begin=d.value,B.style.display="none",a())},E[1].onclick=function(){B.style.display="none"}}},a=function(){e.style.display="none",t.style.display="block";let l=document.getElementById("data00"),n=document.getElementById("data01"),a=document.getElementById("data02"),o=document.getElementById("data03"),r=document.getElementById("data04"),c=document.getElementById("data05"),m=document.getElementById("data06"),s=document.getElementById("show1"),d=document.getElementById("show2"),i=document.getElementById("btn2"),b=t.querySelectorAll("label"),v=document.getElementById("material1"),N=document.getElementById("material2"),y=document.getElementById("material3"),h=document.getElementById("btn3"),g=document.getElementById("btn4"),p=document.querySelector(".playBtn"),x=document.querySelector(".backBtn"),f=document.querySelector(".dataBtn"),B=document.querySelector(".recastBox"),I=B.querySelectorAll("a"),E=document.getElementById("myMusic"),k=document.getElementById("input3"),w=document.getElementById("printBox");0!==Object.keys(u).length&&(l.value=parseInt(u.attack),n.value=u.weight,a.value=u.hardness,o.value=u.toughness);let F=null,T=null,S=null,q=!1,C={},j=null,M=1,V=1,O=0,Z=!1,A=!1,G=a.value,R=o.value,X=[l.value,n.value,a.value,o.value,r.value],H=parseFloat(u.mold),J=["长剑","短剑","软剑","重剑","刺剑"],L=["长刀","大环刀","短刀","弯刀","双刃斧"],P=["长棍","狼牙棒","三节棍","长枪","战戟"],z=["长鞭","软鞭","九节鞭","杆子鞭","链枷"],Q=["双环","对剑","双钩"],W=J.concat(L).concat(P).concat(z).concat(Q),Y=function(){let e=["1","0.033","0.4","-0.4","1","1","0.02","-0.4","0.4","1","1.1","0.01","0.15","-0.15","1.2","1.2","0.033","0.38","-0.38","1.1","1.2","0.02","-0.38","0.38","1.3","1.4","0.01","0.35","-0.25","1.45","1.2","0.03","0.05","-0.05","1.6","1.3","0.02","-0.25","0.25","1.7","1.4","0.01","0.03","-0.03","1.85","1.6","0.033","0.25","-0.2","1","1.4","0.02","-0.1","0.25","1.2","1.75","0.01","0.15","-0.05","1.2","1.25","0.01","0.2","-0.12","1.1","1.4","0.015","-0.15","0.25","1.15","1.5","0.01","0.12","-0.08","1.25"],t=["1.1","0.033","0.35","-0.2","1","1.2","0.02","-0.2","0.35","1.1","1.35","0.01","0.15","-0.15","1.25","1","0.025","0.33","-0.3","1","1.1","0.01","-0.25","0.28","1.1","1.2","0.01","0.2","-0.2","1.25","1.2","0.01","0.4","-0.4","1.1","1.3","0.02","-0.15","0.15","1","1.25","0.01","0.1","-0.1","1.2","1.1","0.03","0.2","-0.12","1","1.3","0.02","-0.12","0.2","1","1.15","0.015","0.15","-0.15","1.25","1.2","0.025","0.3","-0.32","1","1.25","0.038","-0.15","0.27","1.1","1.3","0.02","0.25","-0.22","1.25"],u=["1.1","0.03","0.3","-0.2","1","1.2","0.05","-0.2","0.25","1.1","1.25","0.05","0.2","-0.15","1.2","1","0.25","0.28","-0.15","1","1.1","0.05","-0.2","0.2","1.1","1.2","0.03","0.15","-0.15","1.2","1","0.02","0.12","-0.08","1","1.1","0.02","-0.4","0.4","1","1.25","0.01","0.1","-0.1","1.25","0.85","0.05","0.25","-0.2","1","0.9","0.04","-0.2","0.25","1.1","1","0.03","0.15","-0.15","1.35","0.95","0.05","0.22","-0.1","1","1","0.04","-0.2","0.18","1.1","1.15","0.03","0.15","-0.15","1.2"],l=["1","0.01","0.3","-0.3","1","1","0.01","-0.3","0.3","1.1","1.2","0.01","0.2","-0.2","1.25","0.8","0.005","0.15","-0.1","1.2","0.8","0.004","-0.1","0.25","1.25","1","0.002","0.1","-0.1","1.4","1","0.15","0.25","-0.2","1","0.9","0.1","-0.2","0.25","1.1","1.1","0.1","0.15","-0.15","1.25","0.75","0.03","0.15","-0.15","1.2","0.9","0.02","-0.15","0.15","1.3","1","0.01","0.1","-0.1","1.4","1.1","0.05","0.25","-0.1","1","0.98","0.08","-0.2","0.25","1.1","1.2","0.1","0.15","-0.05","1.2"],n=["1.15","0.04","0.2","-0.05","1.1","1.15","0.04","-0.12","0.2","1.1","0.9","0.03","0.14","0.1","0.85","1.2","0.05","0.2","-0.05","1.1","1.25","0.05","-0.12","0.2","1.1","1.1","0.04","0.14","0.1","1","1.6","0.04","0.23","-0.12","1","1.6","0.04","-0.12","0.23","1","1.4","0.03","0.18","0.18","1.1"],a=H,o=H,r=null,c=null;switch(r=0===(o=parseFloat(o)%5)?60:15*o-15,c=0===o?74:15*o-1,Math.floor(a/5.1)){case 0:F=["锐金","玄铁","晶竹"],T=e.slice(r,c+1);break;case 1:F=["陨铁","锡沙","秘银"],T=t.slice(r,c+1);break;case 2:F=["降龙木","锰钢","血龙木"],T=u.slice(r,c+1);break;case 3:F=["古藤","绵铁","蟒筋"],T=l.slice(r,c+1);break;case 4:F=["镜铁","磷石","黄晶"],T=n.slice(r,c+1)}return T};new Promise((e,t)=>{let u=null,l=new XMLHttpRequest;l.open("GET","json/recast.txt"),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(u=l.responseText,e(u))},l.send(null)}).then(function(e){let t=e.toString();j=t.split(" ");let l=parseInt(u.mold),n=6*(l-1),a=6*l-1;S=j.slice(n,a+1)}).then(Y).then(function(){if(0!==Object.keys(S).length){let e=S[4].split(","),t=S[5].split(",");v.textContent=F[0],N.textContent=F[1],y.textContent=F[2],C["c-name"]=S[0],C["c-attack"]=Number(S[1]),C["c-weight"]=Number(S[3]),C["c-down-hardness"]=Number(e[0]),C["c-up-hardness"]=Number(e[1]),C["c-down-toughness"]=Number(t[0]),C["c-up-toughness"]=Number(t[1]),w.innerText+="初始神兵"+C["c-name"]+"\n"}});let $=function(e,t,u){if(Number(e[1])<Number(t[1])&&Number(l.value)>=460)l.value=460;else if(Number(e[1])>Number(t[1])&&Number(l.value)>=460)l.value=460,w.innerText+="伤害不准确\n神兵已作废\n";else{let u=Number(l.value)+Number(r.value)*(Number(t[1])-Number(e[1]));l.value=u>460?460:u}n.value=Number(n.value)/Number(e[3])*Number(t[3]);let c=e[4].split(","),m=e[5].split(","),s=t[4].split(","),d=t[5].split(",");return a.value=(Number(s[1])-Number(s[0]))*(Number(a.value)-Number(c[0]))/(Number(c[1])-Number(c[0]))+Number(s[0]),Number(a.value)<Number(s[0])&&(a.value=Number(s[0])),Number(a.value)>Number(s[1])&&(a.value=Number(s[1])),o.value=(Number(d[1])-Number(d[0]))*(Number(o.value)-Number(m[0]))/(Number(m[1])-Number(m[0]))+Number(d[0]),Number(o.value)<Number(d[0])&&(o.value=Number(d[0])),Number(o.value)>Number(d[1])&&(o.value=Number(d[1])),[s,d,t[3]]},D=function(e){b[1].childNodes[0].nodeValue="当前重量(上限"+e[2]+")",b[2].childNodes[0].nodeValue="当前硬度(上限"+e[0][1]+")",b[3].childNodes[0].nodeValue="当前韧度(上限"+e[1][1]+")",C["c-weight"]=e[2],C["c-down-hardness"]=e[0][0],C["c-up-hardness"]=e[0][1],C["c-down-toughness"]=e[1][0],C["c-up-toughness"]=e[1][1]};c.onchange=function(){s.innerText=this.value,a.value=Number(G)+Number(this.value)},m.onchange=function(){d.innerText=this.value,o.value=Number(R)+Number(this.value)},i.onclick=function(){c.disabled=!0,m.disabled=!0,q=!0,b[1].childNodes[0].nodeValue="当前重量(上限"+C["c-weight"]+")",b[2].childNodes[0].nodeValue="当前硬度(上限"+C["c-up-hardness"]+")",b[3].childNodes[0].nodeValue="当前韧度(上限"+C["c-up-toughness"]+")",this.style.color="#eee"},v.onclick=function(){for(O=0;M;)q&&Number(r.value)<300&&(X=[l.value,n.value,a.value,o.value,r.value,H],Number(l.value)<460&&(l.value=(Number(l.value)+Number(T[0])).toFixed(2)),Number(n.value)<C["c-weight"]&&(n.value=(Number(n.value)+Number(T[1])).toFixed(2)),!(Number(a.value)>=C["c-up-hardness"]&&Number(T[2])>0||Number(a.value)<C["c-down-hardness"]&&Number(T[2])<0)&&(a.value=(Number(a.value)+Number(T[2])).toFixed(2)),!(Number(o.value)>=C["c-up-toughness"]&&Number(T[3])>0||Number(o.value)<C["c-down-toughness"]&&Number(T[3])<0)&&(o.value=(Number(o.value)+Number(T[3])).toFixed(2)),r.value=Number(r.value)+1,O++),M--;M=Number(k.value),q&&Number(r.value)<=300&&O&&(w.innerText+="淬炼了"+O+this.textContent+"\n")},N.onclick=function(){for(O=0;M;)X=[l.value,n.value,a.value,o.value,r.value,H],q&&Number(r.value)<300&&(Number(l.value)<460&&(l.value=(Number(l.value)+Number(T[5])).toFixed(2)),Number(n.value)<C["c-weight"]&&(n.value=(Number(n.value)+Number(T[6])).toFixed(3)),!(Number(a.value)>=C["c-up-hardness"]&&Number(T[7])>0||Number(a.value)<C["c-down-hardness"]&&Number(T[7])<0)&&(a.value=(Number(a.value)+Number(T[7])).toFixed(2)),!(Number(o.value)>=C["c-up-toughness"]&&Number(T[8])>0||Number(o.value)<C["c-down-toughness"]&&Number(T[8])<0)&&(o.value=(Number(o.value)+Number(T[8])).toFixed(2)),r.value=Number(r.value)+1,O++),M--;M=Number(k.value),q&&Number(r.value)<=300&&O&&(w.innerText+="淬炼了"+O+this.textContent+"\n")},y.onclick=function(){for(O=0;M;)X=[l.value,n.value,a.value,o.value,r.value,H],q&&Number(r.value)<300&&(Number(l.value)<460&&(l.value=(Number(l.value)+Number(T[10])).toFixed(2)),Number(n.value)<C["c-weight"]&&(n.value=(Number(n.value)+Number(T[11])).toFixed(2)),!(Number(a.value)>=C["c-up-hardness"]&&Number(T[12])>0||Number(a.value)<C["c-down-hardness"]&&Number(T[12])<0)&&(a.value=(Number(a.value)+Number(T[12])).toFixed(2)),!(Number(o.value)>=C["c-up-toughness"]&&Number(T[13])>0||Number(o.value)<C["c-down-toughness"]&&Number(T[13])<0)&&(o.value=(Number(o.value)+Number(T[13])).toFixed(2)),r.value=Number(r.value)+1,O++),M--;M=Number(k.value),q&&Number(r.value)<=300&&O&&(w.innerText+="淬炼了"+O+this.textContent+"\n")},h.onclick=function(){if(V%2==0){if((M=Number(k.value))<1||M>300-Number(r.value))return M=1,void(k.value=1);this.style.background="#000",this.textContent="锁定解除",k.disabled=!0}else M=1,this.style.background="#c8e3c8",this.textContent="倍数锁定",k.disabled=!1,k.value=1;V++},p.onclick=function(){null!==E&&(E.paused?E.play():E.pause()),Z?(this.className="playBtn",Z=!Z):(this.className+=" active",Z=!Z)},x.onclick=function(){H===X[5]&&r.value!==X[4]&&(l.value=X[0],n.value=X[1],a.value=X[2],o.value=X[3],r.value=X[4],w.innerText+="回退了一次淬炼\n")},f.onclick=function(){w.innerText+="伤害 重量 硬度 韧度\n",w.innerText+=T.slice(0,4).join(" | ")+"\n",w.innerText+=T.slice(5,9).join(" | ")+"\n",w.innerText+=T.slice(10,14).join(" | ")+"\n"},g.onclick=function(){if(q&&!A){A=!0,B.style.display="block";let e=[],t=u.mold;t<=5&&(e=J.slice()),t<=10&&H>5&&(e=L.slice()),t<=15&&H>10&&(e=P.slice()),t<=20&&H>15&&(e=z.slice()),t>20&&(e=Q.slice());let l=e.splice(H%5-1,1);for(let n=0;n<I.length;n++)I[n].textContent=e[n],I[n].onclick=function(){w.innerText+=l+"重铸成"+this.textContent+"\n",H=W.indexOf(this.textContent)+1,u.mold=H;let e=j.slice(6*(t-1),6*t),n=j.slice(6*(H-1),6*H),a=(Y(),$(e,n));D(a)}}else q&&A&&(A=!1,B.style.display="none")},B.onclick=function(){A=!1,B.style.display="none"}},o=window.location.href,r=o.indexOf("#");switch(-1===r?null:o.slice(r+1)){case"first":n();break;case"second":a();break;default:n()}}();