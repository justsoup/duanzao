!function(){let e=document.querySelector(".mainBox1"),t=document.querySelector(".mainBox2"),u={},l=function(){t.style.display="none",e.style.display="block";let l=document.getElementById("selectBox"),a=document.getElementById("select2Box"),o=(l.getElementsByTagName("options"),document.getElementById("grade")),r=document.getElementById("btn"),c=document.getElementById("result"),m=document.getElementById("imgBox"),s=document.getElementById("data1"),i=document.getElementById("data2"),d=document.getElementById("data3"),v=document.getElementById("data4"),b=document.getElementById("data5"),N=document.getElementById("data6"),h=document.getElementById("data7"),y=document.getElementById("data8"),g=document.getElementById("data9"),p=null,x=null,f=document.querySelector(".hiddenBox"),B={0:1100,1:1200,2:1200,3:1300,4:1700,5:1800,6:1800,7:1900,8:2200,9:2300,10:2300,11:2400};new Promise((e,t)=>{let u=null,l=new XMLHttpRequest;l.open("GET","json/attribute.txt"),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(u=l.responseText,e(u))},l.send(null)}).then(function(e){let t=e.toString();p=t.split(/[a-w]/i)}),r.onclick=function(){let e=o.value,t=l.selectedIndex,u=null,n=B[t],a=null,r=null,i=800;if(u=t<4?250:t<8?350:500,(i=i+100*parseFloat(b.value)+100*parseFloat(N.value)+60*parseFloat(h.value)+50*parseFloat(y.value))<parseFloat(n)){let e=parseFloat(n)-parseFloat(i);return c.innerText="失败了，需要再多加点燃料\n",void(c.innerText+="还缺少"+e+"°")}(a=function(e=0,t=0){return 250*e/t}(i,n))>u&&(a=u),r=Math.floor(e/50+3*a/20+.5*parseFloat(g.value)),x=1.2*r+parseFloat(s.value),x=Math.floor(100*x)/100,c.innerText="初始伤害为 "+x+"(只取整)\n",c.innerText+="锻造结果等级 "+r+"\n",0==l.value&&(console.log(l.value),c.innerText+="资料来源：放置江湖攻略组 \n"),m.style.display="block"};let E=function(){let e=l.value,t=a.value,u=p[t].replace(/^\s*|\s*$/g,"").split("\n")[e].split("\t");s.value=u[2],i.value=u[4],d.value=u[5],v.value=u[3]};l.onchange=E,a.onchange=E,m.onclick=function(){m.style.display="none",f.style.display="block"},f.onclick=function(){u.attack=x,u.hardness=i.value,u.toughness=d.value,u.weight=v.value,u.mold=a.value,n()}},n=function(){e.style.display="none",t.style.display="block";let l=document.getElementById("data00"),n=document.getElementById("data01"),a=document.getElementById("data02"),o=document.getElementById("data03"),r=document.getElementById("data04"),c=document.getElementById("data05"),m=document.getElementById("data06"),s=document.getElementById("show1"),i=document.getElementById("show2"),d=document.getElementById("btn2"),v=t.querySelectorAll("label"),b=document.getElementById("material1"),N=document.getElementById("material2"),h=document.getElementById("material3"),y=document.getElementById("btn3"),g=document.getElementById("btn4"),p=document.querySelector(".playBtn"),x=document.querySelector(".backBtn"),f=document.querySelector(".dataBtn"),B=document.querySelector(".resetBtn"),E=document.querySelector(".recastBox"),I=E.querySelectorAll("a"),k=document.getElementById("myMusic"),w=document.getElementById("input3"),F=document.getElementById("printBox");0!==Object.keys(u).length&&(l.value=parseInt(u.attack),n.value=u.weight,a.value=u.hardness,o.value=u.toughness);let T=null,S=null,q=null,C=!1,V={},j=null,M=1,O=1,A=0,G=!1,H=!1,L=!1,P=a.value,R=o.value,X=[l.value,n.value,a.value,o.value,r.value],$=parseFloat(u.mold),z=["长剑","短剑","软剑","重剑","刺剑"],D=["长刀","大环刀","短刀","弯刀","双刃斧"],J=["长棍","狼牙棒","三节棍","长枪","战戟"],K=["长鞭","软鞭","九节鞭","杆子鞭","链枷"],Q=["双环","对剑","双钩"],U=z.concat(D).concat(J).concat(K).concat(Q),W=function(){let e=["1","0.033","0.4","-0.4","1","1","0.02","-0.4","0.4","1","1.1","0.01","0.15","-0.15","1.2","1.2","0.033","0.38","-0.38","1.1","1.2","0.02","-0.38","0.38","1.3","1.4","0.01","0.35","-0.25","1.45","1.2","0.03","0.05","-0.05","1.6","1.3","0.02","-0.25","0.25","1.7","1.4","0.01","0.03","-0.03","1.85","1.6","0.033","0.25","-0.2","1","1.4","0.02","-0.1","0.25","1.2","1.75","0.01","0.15","-0.05","1.2","1.25","0.01","0.2","-0.12","1.1","1.4","0.015","-0.15","0.25","1.15","1.5","0.01","0.12","-0.08","1.25"],t=["1.1","0.033","0.35","-0.2","1","1.2","0.02","-0.2","0.35","1.1","1.35","0.01","0.15","-0.15","1.25","1","0.025","0.33","-0.3","1","1.1","0.01","-0.25","0.28","1.1","1.2","0.01","0.2","-0.2","1.25","1.2","0.01","0.4","-0.4","1.1","1.3","0.02","-0.15","0.15","1","1.25","0.01","0.1","-0.1","1.2","1.1","0.03","0.2","-0.12","1","1.3","0.02","-0.12","0.2","1","1.15","0.015","0.15","-0.15","1.25","1.2","0.025","0.3","-0.32","1","1.25","0.038","-0.15","0.27","1.1","1.3","0.02","0.25","-0.22","1.25"],u=["1.1","0.03","0.3","-0.2","1","1.2","0.05","-0.2","0.25","1.1","1.25","0.05","0.2","-0.15","1.2","1","0.25","0.28","-0.15","1","1.1","0.05","-0.2","0.2","1.1","1.2","0.03","0.15","-0.15","1.2","1","0.02","0.12","-0.08","1","1.1","0.02","-0.4","0.4","1","1.25","0.01","0.1","-0.1","1.25","0.85","0.05","0.25","-0.2","1","0.9","0.04","-0.2","0.25","1.1","1","0.03","0.15","-0.15","1.35","0.95","0.05","0.22","-0.1","1","1","0.04","-0.2","0.18","1.1","1.15","0.03","0.15","-0.15","1.2"],l=["1","0.01","0.3","-0.3","1","1","0.01","-0.3","0.3","1.1","1.2","0.01","0.2","-0.2","1.25","0.8","0.005","0.15","-0.1","1.2","0.8","0.004","-0.1","0.25","1.25","1","0.002","0.1","-0.1","1.4","1","0.15","0.25","-0.2","1","0.9","0.1","-0.2","0.25","1.1","1.1","0.1","0.15","-0.15","1.25","0.75","0.03","0.15","-0.15","1.2","0.9","0.02","-0.15","0.15","1.3","1","0.01","0.1","-0.1","1.4","1.1","0.05","0.25","-0.1","1","0.98","0.08","-0.2","0.25","1.1","1.2","0.1","0.15","-0.05","1.2"],n=["1.15","0.04","0.2","-0.05","1.1","1.15","0.04","-0.12","0.2","1.1","0.9","0.03","0.14","0.1","0.85","1.2","0.05","0.2","-0.05","1.1","1.25","0.05","-0.12","0.2","1.1","1.1","0.04","0.14","0.1","1","1.6","0.04","0.23","-0.12","1","1.6","0.04","-0.12","0.23","1","1.4","0.03","0.18","0.18","1.1"],a=$,o=$,r=null,c=null;switch(r=0===(o=parseFloat(o)%5)?60:15*o-15,c=0===o?74:15*o-1,Math.floor(a/5.1)){case 0:T=["锐金","玄铁","晶竹"],S=e.slice(r,c+1);break;case 1:T=["陨铁","锡沙","秘银"],S=t.slice(r,c+1);break;case 2:T=["降龙木","锰钢","血龙木"],S=u.slice(r,c+1);break;case 3:T=["古藤","绵铁","蟒筋"],S=l.slice(r,c+1);break;case 4:T=["镜铁","磷石","黄晶"],S=n.slice(r,c+1)}},Y=function(){if(0!==Object.keys(q).length){let e=q[4].split(","),t=q[5].split(",");b.textContent=T[0],N.textContent=T[1],h.textContent=T[2],V["c-name"]=q[0],V["c-attack"]=Number(q[1]),V["c-weight"]=Number(q[3]),V["c-down-hardness"]=Number(e[0]),V["c-up-hardness"]=Number(e[1]),V["c-down-toughness"]=Number(t[0]),V["c-up-toughness"]=Number(t[1]),F.innerText="初始神兵"+V["c-name"]+"\n"}};new Promise((e,t)=>{let u=null,l=new XMLHttpRequest;l.open("GET","json/recast.txt"),l.onreadystatechange=function(){4===l.readyState&&200===l.status&&(u=l.responseText,e(u))},l.send(null)}).then(function(e){let t=e.toString();j=t.split(" ");let l=parseInt(u.mold),n=6*(l-1),a=6*l-1;q=j.slice(n,a+1)}).then(W).then(Y);let Z=function(e,t,u){if(Number(e[1])<Number(t[1])&&Number(l.value)>=460)l.value=460;else if(Number(e[1])>Number(t[1])&&Number(l.value)>=460)l.value=460,F.innerText+="伤害不准确\n神兵已作废\n";else{let u=Number(l.value)+Number(r.value)*(Number(t[1])-Number(e[1]));l.value=u>460?460:u}n.value=Number(n.value)/Number(e[3])*Number(t[3]);let c=e[4].split(","),m=e[5].split(","),s=t[4].split(","),i=t[5].split(",");return a.value=(Number(s[1])-Number(s[0]))*(Number(a.value)-Number(c[0]))/(Number(c[1])-Number(c[0]))+Number(s[0]),Number(a.value)>Number(s[1])&&(a.value=Number(s[1])),o.value=(Number(i[1])-Number(i[0]))*(Number(o.value)-Number(m[0]))/(Number(m[1])-Number(m[0]))+Number(i[0]),Number(o.value)>Number(i[1])&&(o.value=Number(i[1])),[s,i,t[3]]},_=function(e){V["c-weight"]=e[2],V["c-down-hardness"]=e[0][0],V["c-up-hardness"]=e[0][1],V["c-down-toughness"]=e[1][0],V["c-up-toughness"]=e[1][1],ee()};c.onchange=function(){s.innerText=this.value,a.value=Number(P)+Number(this.value)},m.onchange=function(){i.innerText=this.value,o.value=Number(R)+Number(this.value)},d.onclick=function(){Number(a.value)>Number(V["c-up-hardness"])&&(a.value=V["c-up-hardness"]),c.disabled=!0,m.disabled=!0,ee(),this.style.color="#eee",C||(resetValue=[l.value,n.value,a.value,o.value,r.value,u.mold]),C=!0},b.onclick=function(){for(A=0;M;)C&&Number(r.value)<300&&(X=[l.value,n.value,a.value,o.value,r.value,$],Number(l.value)<460&&(l.value=(Number(l.value)+Number(S[0])).toFixed(2)),Number(n.value)<V["c-weight"]&&(n.value=(Number(n.value)+Number(S[1])).toFixed(2)),!(Number(a.value)>=V["c-up-hardness"]&&Number(S[2])>0||Number(a.value)<V["c-down-hardness"]&&Number(S[2])<0)&&(a.value=(Number(a.value)+Number(S[2])).toFixed(2)),!(Number(o.value)>=V["c-up-toughness"]&&Number(S[3])>0||Number(o.value)<V["c-down-toughness"]&&Number(S[3])<0)&&(o.value=(Number(o.value)+Number(S[3])).toFixed(2)),r.value=Number(r.value)+1,A++),M--;M=Number(w.value),C&&Number(r.value)<=300&&A&&(F.innerText+="淬炼了"+A+this.textContent+"\n")},N.onclick=function(){for(A=0;M;)X=[l.value,n.value,a.value,o.value,r.value,$],C&&Number(r.value)<300&&(Number(l.value)<460&&(l.value=(Number(l.value)+Number(S[5])).toFixed(2)),Number(n.value)<V["c-weight"]&&(n.value=(Number(n.value)+Number(S[6])).toFixed(3)),!(Number(a.value)>=V["c-up-hardness"]&&Number(S[7])>0||Number(a.value)<V["c-down-hardness"]&&Number(S[7])<0)&&(a.value=(Number(a.value)+Number(S[7])).toFixed(2)),!(Number(o.value)>=V["c-up-toughness"]&&Number(S[8])>0||Number(o.value)<V["c-down-toughness"]&&Number(S[8])<0)&&(o.value=(Number(o.value)+Number(S[8])).toFixed(2)),r.value=Number(r.value)+1,A++),M--;M=Number(w.value),C&&Number(r.value)<=300&&A&&(F.innerText+="淬炼了"+A+this.textContent+"\n")},h.onclick=function(){for(A=0;M;)X=[l.value,n.value,a.value,o.value,r.value,$],C&&Number(r.value)<300&&(Number(l.value)<460&&(l.value=(Number(l.value)+Number(S[10])).toFixed(2)),Number(n.value)<V["c-weight"]&&(n.value=(Number(n.value)+Number(S[11])).toFixed(2)),!(Number(a.value)>=V["c-up-hardness"]&&Number(S[12])>0||Number(a.value)<V["c-down-hardness"]&&Number(S[12])<0)&&(a.value=(Number(a.value)+Number(S[12])).toFixed(2)),!(Number(o.value)>=V["c-up-toughness"]&&Number(S[13])>0||Number(o.value)<V["c-down-toughness"]&&Number(S[13])<0)&&(o.value=(Number(o.value)+Number(S[13])).toFixed(2)),r.value=Number(r.value)+1,A++),M--;M=Number(w.value),C&&Number(r.value)<=300&&A&&(F.innerText+="淬炼了"+A+this.textContent+"\n")},y.onclick=function(){if(O%2==0){if((M=Number(w.value))<1||M>300-Number(r.value))return M=1,void(w.value=1);this.style.background="#000",this.textContent="锁定解除",w.disabled=!0}else M=1,this.style.background="#c8e3c8",this.textContent="倍数锁定",w.disabled=!1,w.value=1;O++},p.onclick=function(){null!==k&&(k.paused?k.play():k.pause()),H?(this.className="playBtn",H=!H):(this.className+=" active",H=!H)},x.onclick=function(){$===X[5]&&r.value!==X[4]&&(l.value=X[0],n.value=X[1],a.value=X[2],o.value=X[3],r.value=X[4],F.innerText+="回退了一次淬炼\n")},f.onclick=function(){F.innerText+="伤害 重量 硬度 韧度\n",F.innerText+=S.slice(0,4).join(" | ")+"\n",F.innerText+=S.slice(5,9).join(" | ")+"\n",F.innerText+=S.slice(10,14).join(" | ")+"\n"},B.onclick=function(){C&&(l.value=resetValue[0],n.value=resetValue[1],a.value=resetValue[2],o.value=resetValue[3],r.value=0,$=parseFloat(resetValue[4]),X[5]=null,W(),F.innerText="初始神兵"+q[0]+"\n",G=!0,ee())},g.onclick=function(){if(C&&!L){L=!0,E.style.display="block";let e=[],t=u.mold;t<=5&&(e=z.slice()),t<=10&&$>5&&(e=D.slice()),t<=15&&$>10&&(e=J.slice()),t<=20&&$>15&&(e=K.slice()),t>20&&(e=Q.slice());let l=e.splice($%5-1,1);for(let n=0;n<I.length;n++)I[n].textContent=e[n],I[n].onclick=function(){F.innerText+=l+"重铸成"+this.textContent+"\n",$=U.indexOf(this.textContent)+1,u.mold=$;let e=j.slice(6*(t-1),6*t),n=j.slice(6*($-1),6*$),a=(W(),Z(e,n));_(a)}}else C&&L&&(L=!1,E.style.display="none")},E.onclick=function(){L=!1,E.style.display="none"};let ee=function(){G&&(Y(),G=!1),v[1].childNodes[0].nodeValue="当前重量(上限"+V["c-weight"]+")",v[2].childNodes[0].nodeValue="当前硬度(上限"+V["c-up-hardness"]+")",v[3].childNodes[0].nodeValue="当前韧度(上限"+V["c-up-toughness"]+")"}},a=window.location.href,o=a.indexOf("#");switch(-1===o?null:a.slice(o+1)){case"first":l();break;case"second":n();break;default:l()}}();